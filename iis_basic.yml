---
- name: Install the iis web service
  hosts: "{{ hostlist | default('all') }}"
  vars:
    iis_test_message: "Hello, World from host {{ inventory_hostname }}!"
  tasks:
    - name: Stop the play if the host is not a Windows system
      ansible.builtin.meta: end_host
      when: ansible_facts['os_family'] is not defined or ansible_facts['os_family'] != "Windows"     # Other options: RedHat, Darwin

    - name: Install iis
      ansible.windows.win_feature:
        name: Web-Server
        state: present

    - name: Start iis service
      ansible.windows.win_service:
        name: W3Svc
        state: started

    - name: Create website index.html
      ansible.windows.win_copy:
        content: "{{ iis_test_message }}"
        dest: C:\Inetpub\wwwroot\index.html

    - name: Show website address
      ansible.builtin.debug:
        msg: http://{{ ansible_host }}
